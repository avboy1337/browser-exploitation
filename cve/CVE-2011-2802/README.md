<b>VULNERABILITY DETAILS</b>

The following code crashes an optimized v8 shell (version as in Chrome 14.0.813.0 which is v8-trunk r8431) or asserts in a debug shell. The same code does not crash in Chromium, I suspect it could be that the memory layout is different there and the specific test case therefore fails on Chromium. Please check if this really does not affect Chromium as well.

Debug builds abort with:

#
# Fatal error in src/objects.cc, line 1797
# CHECK(!value->IsTheHole()) failed
#

<b>VERSION</b>
V8 Version: http://v8.googlecode.com/svn/trunk@8431 (as in Chrome Version 14.0.813.0).
Operating System: Ubuntu Linux 11.04

<b>REPRODUCTION CASE</b>

(function () {
  function classOf(object) { typeof(value); };
})();
function F() {}
Object.prototype.__defineSetter__('x', function(value) { result_x = value; });
this.__proto__ = { x: 42 };
try {
  fail;
} catch (e) {
  eval('const x = 7');
}


<b>FOR CRASHES, PLEASE INCLUDE THE FOLLOWING ADDITIONAL INFORMATION</b>
Type of crash: Shell
Crash Trace:

==26391== Use of uninitialised value of size 8
==26391==    at 0x4E3490: v8::internal::JSObject::GetNormalizedProperty(v8::internal::LookupResult*) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x5502A2: v8::internal::Runtime_InitializeConstContextSlot(v8::internal::Arguments, v8::internal::Isolate*) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x9F48341: ???
==26391==    by 0x9F6C0DD: ???
==26391==    by 0x9F48C2D: ???
==26391==    by 0x9F6B08E: ???
==26391==    by 0x9F493E6: ???
==26391==    by 0x9F48127: ???
==26391==    by 0x447FA8: v8::internal::Invoke(bool, v8::internal::Handle<v8::internal::JSFunction>, v8::internal::Handle<v8::internal::Object>, int, v8::internal::Object***, bool*) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x448468: v8::internal::Execution::Call(v8::internal::Handle<v8::internal::Object>, v8::internal::Handle<v8::internal::Object>, int, v8::internal::Object***, bool*) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x414477: v8::Script::Run() (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x402F73: ExecuteString(v8::Handle<v8::String>, v8::Handle<v8::Value>, bool, bool) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391== 
==26391== Invalid read of size 8
==26391==    at 0x4E3490: v8::internal::JSObject::GetNormalizedProperty(v8::internal::LookupResult*) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x5502A2: v8::internal::Runtime_InitializeConstContextSlot(v8::internal::Arguments, v8::internal::Isolate*) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x9F48341: ???
==26391==    by 0x9F6C0DD: ???
==26391==    by 0x9F48C2D: ???
==26391==    by 0x9F6B08E: ???
==26391==    by 0x9F493E6: ???
==26391==    by 0x9F48127: ???
==26391==    by 0x447FA8: v8::internal::Invoke(bool, v8::internal::Handle<v8::internal::JSFunction>, v8::internal::Handle<v8::internal::Object>, int, v8::internal::Object***, bool*) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x448468: v8::internal::Execution::Call(v8::internal::Handle<v8::internal::Object>, v8::internal::Handle<v8::internal::Object>, int, v8::internal::Object***, bool*) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x414477: v8::Script::Run() (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==    by 0x402F73: ExecuteString(v8::Handle<v8::String>, v8::Handle<v8::Value>, bool, bool) (in /scratch/holler/LangFuzz/v8-trunk/shell)
==26391==  Address 0xffffffff96781a20 is not stack'd, malloc'd or (recently) free'd
==26391== 
==26391== 
==26391== Process terminating with default action of signal 11 (SIGSEGV)
==26391==  Access not within mapped region at address 0xFFFFFFFF96781A20

