UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36

Steps to reproduce the problem:

1. Test Environment

commit: 
```
	117ddc8f6d026dfef11a61a93467956d9247868c
```

x64.debug args.gn:

```
	is_component_build = true
	is_debug = true
	symbol_level = 2
	target_cpu = "x64"
	use_goma = false
	goma_dir = "None"
	v8_enable_backtrace = true
	v8_enable_fast_mksnapshot = true
	v8_enable_slow_dchecks = true
	v8_optimized_debug = false

```

x64.release args.gn:

```

	is_component_build = false
	is_debug = false
	target_cpu = "x64"
	use_goma = false
	goma_dir = "None"
	v8_enable_backtrace = true
	v8_enable_disassembler = true
	v8_enable_object_print = true
	v8_enable_verify_heap = true

```

I have attached two PoC, the original generated by the fuzzer and a reduced one. Both require --allow-natives-syntax due the usage of "%OptimizeFunctionOnNextCall".

2. Reproing the bug

Just run:
```

	.\d8.exe --allow-natives-syntax reduced_poc.js

```

3. OS: Windows 10

What is the expected behavior?

In debug builds the expected behavior is the following DCHECK:

```

	PS C:\v8\v8\v8> .\out\x64.debug\d8.exe --allow-natives-syntax .\out\x64.debug\reduced_poc.js                   

	#
	# Fatal error in ../../src/compiler/code-assembler.cc, line 1977
	# Type cast failed in CAST(feedback_element) at ../../src/codegen/code-stub-assembler.cc:10166
	  Expected Smi but found 00000240FFBC0111: [Map] in ReadOnlySpace
	 - type: FREE_SPACE_TYPE
	 - instance size: variable
	 - elements kind: HOLEY_ELEMENTS
	 - unused property fields: 0
	 - enum length: invalid
	 - stable_map
	 - back pointer: 0x0240ffbc04a9 <undefined>
	 - prototype_validity cell: 0
	 - instance descriptors (own) #0: 0x0240ffbc0231 <DescriptorArray[0]>
	 - layout descriptor: 0000000000000000
	 - prototype: 0x0240ffbc01b1 <null>
	 - constructor: 0x0240ffbc01b1 <null>
	 - dependent code: 0x0240ffbc0299 <Other heap object (WEAK_FIXED_ARRAY_TYPE)>
	 - construction counter: 0

	#
	#
	#
	#FailureMessage Object: 00000098115FD0B8
	==== C stack trace ===============================

	        v8::base::debug::StackTrace::StackTrace [0x00007FFE194439AC+44] (C:\v8\v8\v8\src\base\debug\stack_trace_win.cc:173)
	        v8::platform::`anonymous namespace'::PrintStackTrace [0x00007FFE1951FD74+36] (C:\v8\v8\v8\src\libplatform\default-platform.cc:27)
	        V8_Fatal [0x00007FFE194319C5+277] (C:\v8\v8\v8\src\base\logging.cc:181)
	        v8::internal::CheckObjectType [0x00007FFDD597AB3F+20511] (C:\v8\v8\v8\src\compiler\code-assembler.cc:1974)
	        Builtins_IncHandler [0x00007FFDD61CFB59+1433]
	        Builtins_InterpreterEntryTrampoline [0x00007FFDD5DAB41D+957]
	        Builtins_InterpreterEntryTrampoline [0x00007FFDD5DAB41D+957]
	        Builtins_ArgumentsAdaptorTrampoline [0x00007FFDD5D9425C+188]
	        Builtins_InterpreterEntryTrampoline [0x00007FFDD5DAB41D+957]
	        Builtins_InterpreterEntryTrampoline [0x00007FFDD5DAB41D+957]
	        Builtins_JSEntryTrampoline [0x00007FFDD5DA0DA1+97]
	        Builtins_JSEntry [0x00007FFDD5DA098C+204]
	        v8::internal::GeneratedCode<unsigned long long,unsigned long long,unsigned long long,unsigned long long,unsigned long long,long long,unsigned long long **>::Call [0x00007FFDD49304A8+168] (C:\v8\v8\v8\src\execution\simulator.h:138)
	        v8::internal::`anonymous namespace'::Invoke [0x00007FFDD492E751+3121] (C:\v8\v8\v8\src\execution\execution.cc:266)
	        v8::internal::Execution::Call [0x00007FFDD492DAF8+216] (C:\v8\v8\v8\src\execution\execution.cc:358)
	        v8::Script::Run [0x00007FFDD4520A0B+939] (C:\v8\v8\v8\src\api\api.cc:2136)
	        v8::Shell::ExecuteString [0x00007FF7E0F0B068+2664] (C:\v8\v8\v8\src\d8\d8.cc:523)
	        v8::SourceGroup::Execute [0x00007FF7E0F1D532+1122] (C:\v8\v8\v8\src\d8\d8.cc:2450)
	        v8::Shell::RunMain [0x00007FF7E0F21030+448] (C:\v8\v8\v8\src\d8\d8.cc:2923)
	        v8::Shell::Main [0x00007FF7E0F23170+3232] (C:\v8\v8\v8\src\d8\d8.cc:3496)
	        main [0x00007FF7E0F23973+35] (C:\v8\v8\v8\src\d8\d8.cc:3532)
	        invoke_main [0x00007FF7E0F5CD14+52] (d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:79)
	        __scrt_common_main_seh [0x00007FF7E0F5CE4E+302] (d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:288)
	        __scrt_common_main [0x00007FF7E0F5CECE+14] (d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:331)
	        mainCRTStartup [0x00007FF7E0F5CEE9+9] (d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_main.cpp:17)
	        BaseThreadInitThunk [0x00007FFE2F1D7BD4+20]
	        RtlUserThreadStart [0x00007FFE2F58CE71+33]

```

In release builds the expected behavior may vary, but, usually is a crash in "CompilationCacheTable" when checking if the object is a HeapNumber and sometimes in MarkCompactWeakObjectRetainer::RetainAs.

```

	==== C stack trace ===============================

	        v8::internal::CompilationCacheTable::Age [0x00007FF6E9AA9A14+164] (C:\v8\v8\v8\src\objects\objects.cc:7080)
	        v8::internal::CompilationCache::MarkCompactPrologue [0x00007FF6E9802D2F+431] (C:\v8\v8\v8\src\codegen\compilation-cache.cc:366)
	        v8::internal::IncrementalMarking::StartMarking [0x00007FF6E98E3A2A+202] (C:\v8\v8\v8\src\heap\incremental-marking.cc:351)
	        v8::internal::IncrementalMarking::Start [0x00007FF6E98E3877+1031] (C:\v8\v8\v8\src\heap\incremental-marking.cc:313)
	        v8::internal::ArrayBufferTracker::RegisterNew [0x00007FF6E98CEC50+272] (C:\v8\v8\v8\src\heap\array-buffer-tracker-inl.h:40)
	        v8::internal::JSArrayBuffer::SetupAllocatingData [0x00007FF6E9A31214+180] (C:\v8\v8\v8\src\objects\js-array-buffer.cc:142)
	        v8::internal::`anonymous namespace'::ConstructBuffer [0x00007FF6E97A98F3+307] (C:\v8\v8\v8\src\builtins\builtins-arraybuffer.cc:49)
	        v8::internal::Builtin_Impl_ArrayBufferConstructor [0x00007FF6E97A8185+517] (C:\v8\v8\v8\src\builtins\builtins-arraybuffer.cc:83)
	        v8::internal::Builtin_ArrayBufferConstructor [0x00007FF6E97A7CE7+71] (C:\v8\v8\v8\src\builtins\builtins-arraybuffer.cc:61)
	        Builtins_CEntry_Return1_DontSaveFPRegs_ArgvOnStack_BuiltinExit [0x00007FF6EA09E99D+61]
	        Builtins_JSBuiltinsConstructStub [0x00007FF6EA01779A+154]
	        (No symbol) [0x00000023B00C2765]
	        (No symbol) [0x00A0000000000000]
	        (No symbol) [0x000003D2C16004A9]
	        (No symbol) [0x0000000000000007]
	        (No symbol) [0x0000000000000006]
	        (No symbol) [0x000001063DF814C9]
	        (No symbol) [0x000001063DF9F371]
	        (No symbol) [0x000001063DF814C9]
	        (No symbol) [0x000000EEF75FEE00]
	        Builtins_InterpreterEntryTrampoline [0x00007FF6EA01C08C+684]
	        Builtins_InterpreterEntryTrampoline [0x00007FF6EA01C08C+684]
	        Builtins_ArgumentsAdaptorTrampoline [0x00007FF6EA01543C+188]
	        Builtins_InterpreterEntryTrampoline [0x00007FF6EA01C08C+684]
	        Builtins_InterpreterEntryTrampoline [0x00007FF6EA01C08C+684]
	        Builtins_JSEntryTrampoline [0x00007FF6EA019641+97]
	        Builtins_JSEntry [0x00007FF6EA01922C+204]
	        v8::internal::`anonymous namespace'::Invoke [0x00007FF6E98749F1+785] (C:\v8\v8\v8\src\execution\execution.cc:0)
	        v8::internal::Execution::Call [0x00007FF6E98746D1+225] (C:\v8\v8\v8\src\execution\execution.cc:358)
	        v8::Script::Run [0x00007FF6E97532E3+611] (C:\v8\v8\v8\src\api\api.cc:2136)
	        v8::Shell::ExecuteString [0x00007FF6E9736355+1509] (C:\v8\v8\v8\src\d8\d8.cc:523)
	        v8::SourceGroup::Execute [0x00007FF6E9740208+584] (C:\v8\v8\v8\src\d8\d8.cc:2450)
	        v8::Shell::RunMain [0x00007FF6E97421D3+483] (C:\v8\v8\v8\src\d8\d8.cc:2923)
	        v8::Shell::Main [0x00007FF6E9743AE2+3970] (C:\v8\v8\v8\src\d8\d8.cc:3496)
	        __scrt_common_main_seh [0x00007FF6EA268FA8+268] (d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:288)
	        BaseThreadInitThunk [0x00007FFE2F1D7BD4+20]
	        RtlUserThreadStart [0x00007FFE2F58CE71+33]

```

What went wrong?

In release build the crash happens in the following code:

```

	bool Object::IsNumber() const {
	  if (IsSmi()) return true;
	  HeapObject this_heap_object = HeapObject::cast(*this);
	  Isolate* isolate = GetIsolateForPtrCompr(this_heap_object);
	  return this_heap_object.IsHeapNumber(isolate);  <---- [1]
	}

```

At [1] we will verify if the object type is a HEAP_NUMBER_TYPE (0x41), by checking the disassembly when the crash happens we have the following instructions:

```

	00007ff6`e9aa9a10 488b49ff             mov     rcx, qword ptr [rcx-1]    <----------- [2]
	00007ff6`e9aa9a14 6683790b41           cmp     word ptr [rcx+0Bh], 41h ds:00000085`03b007e4=????  <---------- [3]
	00007ff6`e9aa9a19 7565                 jne     d8!v8::internal::CompilationCacheTable::Age+0x110 (00007ff6`e9aa9a80)

```

At [2] we will load the HeapObject map into RCX, let's check contents of (RCX-1):

```

		0:000> r
		rax=0000034730223e89 rbx=0000000000000007 rcx=0000034730203099    <--- HeapObject
		rdx=0000000000000001 rsi=000000ad8e1fe3c0 rdi=0000000000000b70
		rip=00007ff6e9aa9a10 rsp=000000ad8e1fe320 rbp=0000000000000b58
		 r8=0000000000000025  r9=0000000100000000 r10=0000000000008000
		r11=000000ad8e1fe1e0 r12=000000ad8e1fe348 r13=0000008403b00589
		r14=000001ebec823110 r15=ffffffff00000000

		0:000> dq 0000034730203099-1
		00000347`30203098  00000085`03b007d9 00000005`00000000
		00000347`302030a8  00000347`3021f0e9 00000347`3021f4a9
		00000347`302030b8  00000000`00000000 00000083`00000000
		00000347`302030c8  00000084`03b01431 00000084`03b004a9
		00000347`302030d8  00000000`0000000d 00000084`03b00439
		00000347`302030e8  00000001`0f2dc882 00000347`30212c63
		00000347`302030f8  00000084`03b00919 00000009`00000000
		00000347`30203108  0020b9c2`00000000 00000000`00000000

```

AS you can see, RCX hold the address "0000034730203099" (Tagged Pointer), that is our HeapObject, where our Map will be "00000085`03b007d9", that will get its type loaded by rcx+0xB8 [3] and checked against 0x41 (HeapNumber). Let's check the contents of "00000085`03b007d9":

```

	0:000> dq 00000085`03b007d9
	00000085`03b007d9  ????????`???????? ????????`????????
	00000085`03b007e9  ????????`???????? ????????`????????
	00000085`03b007f9  ????????`???????? ????????`????????
	00000085`03b00809  ????????`???????? ????????`????????
	00000085`03b00819  ????????`???????? ????????`????????
	00000085`03b00829  ????????`???????? ????????`????????
	00000085`03b00839  ????????`???????? ????????`????????
	00000085`03b00849  ????????`???????? ????????`????????

```

As we can see, the HeapObject map (00000085`03b007d9) is currently pointing into not mapped memory, leading to an invalid address read and crash. Unfortunately, I couldn't find exactly the root cause that leads to this problem, by checking the other stack trace my "hard guess" is that it's a problem related with the Garbage Collector freeing memory that still in use (anyway it's a hard guess, so I can be totally wrong).

Anyway, if it's not a security issue feel free to make the issue public, if you've any question please feel free to ask, I'll be glad to help! :)

Thanks you!

Did this work before? N/A 

Chrome version: 75.0.3770.100  Channel: n/a
OS Version: 10.0
Flash Version: